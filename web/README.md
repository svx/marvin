# Marvin Web Dashboard

A modern Next.js dashboard for visualizing documentation QA results from the Marvin CLI tool.

## Overview

The web dashboard provides a clean, Stripe-inspired interface to view and analyze documentation quality check results. It reads JSON output files generated by the Marvin CLI and presents them in an organized, filterable dashboard.

## Technology Stack

### Core Framework
- **Next.js 14+** (App Router)
- **React 18+**
- **TypeScript**

### Styling
- **Tailwind CSS** - Utility-first CSS framework
- **Tailwind Typography** - Beautiful typographic defaults
- **CSS Variables** - For theming inspired by Stripe's design system

### UI Components
- **Radix UI** - Accessible, unstyled component primitives
  - `@radix-ui/react-tabs` - Tab navigation
  - `@radix-ui/react-select` - Dropdown selects
  - `@radix-ui/react-dialog` - Modal dialogs
  - `@radix-ui/react-tooltip` - Tooltips
- **Lucide React** - Icon library
- **clsx** / **tailwind-merge** - Conditional class management

### Data & State
- **SWR** or **TanStack Query** - Data fetching and caching
- **Zustand** (optional) - Lightweight state management if needed

### Development Tools
- **ESLint** - Code linting
- **Prettier** - Code formatting
- **TypeScript** - Type safety

## Architecture

### Design Inspiration: Stripe Documentation

The dashboard takes design cues from Stripe's documentation:

1. **Clean, Minimal Layout**
   - Generous white space
   - Clear typography hierarchy
   - Subtle borders and shadows

2. **Color Palette**
   - Primary: Indigo/Blue (`#635BFF` - Stripe-inspired)
   - Success: Green (`#00D924`)
   - Warning: Amber (`#FFA500`)
   - Error: Red (`#DF1B41`)
   - Neutral: Gray scale with subtle tints

3. **Component Patterns**
   - Card-based layouts with subtle shadows
   - Rounded corners (6-8px)
   - Hover states with smooth transitions
   - Badge components for status indicators
   - Data tables with alternating row colors

### Project Structure

```
web/
├── app/                          # Next.js App Router
│   ├── layout.tsx               # Root layout with navigation
│   ├── page.tsx                 # Dashboard home (overview)
│   ├── globals.css              # Global styles & Tailwind
│   ├── checks/                  # Check results pages
│   │   ├── page.tsx            # All checks overview
│   │   └── [checker]/          # Individual checker results
│   │       └── page.tsx        # e.g., /checks/vale
│   └── api/                     # API routes
│       ├── results/
│       │   ├── route.ts        # GET all results
│       │   └── [id]/
│       │       └── route.ts    # GET specific result
│       └── checks/
│           └── route.ts        # POST trigger new check (future)
├── components/                  # React components
│   ├── ui/                     # Reusable UI primitives
│   │   ├── button.tsx
│   │   ├── card.tsx
│   │   ├── badge.tsx
│   │   ├── table.tsx
│   │   ├── tabs.tsx
│   │   └── select.tsx
│   ├── layout/                 # Layout components
│   │   ├── header.tsx
│   │   ├── sidebar.tsx
│   │   └── footer.tsx
│   ├── dashboard/              # Dashboard-specific
│   │   ├── overview-stats.tsx
│   │   ├── recent-checks.tsx
│   │   └── check-history.tsx
│   └── checks/                 # Check result components
│       ├── check-card.tsx
│       ├── issue-list.tsx
│       ├── issue-detail.tsx
│       ├── severity-badge.tsx
│       └── file-tree.tsx
├── lib/                        # Utility functions
│   ├── api.ts                 # API client functions
│   ├── utils.ts               # General utilities
│   ├── types.ts               # TypeScript types
│   └── constants.ts           # Constants & config
├── hooks/                      # Custom React hooks
│   ├── use-results.ts         # Fetch results data
│   └── use-filters.ts         # Filter state management
├── public/                     # Static assets
│   ├── favicon.ico
│   └── images/
├── styles/                     # Additional styles
│   └── stripe-theme.css       # Stripe-inspired theme
├── .env.local                 # Environment variables
├── next.config.js             # Next.js configuration
├── tailwind.config.ts         # Tailwind configuration
├── tsconfig.json              # TypeScript configuration
└── package.json               # Dependencies
```

## Data Models

### TypeScript Interfaces

Based on the CLI's Go models, we'll create TypeScript equivalents:

```typescript
// lib/types.ts

export interface Result {
  checker: string;
  timestamp: string;
  path: string;
  summary: Summary;
  issues: Issue[];
  metadata: Record<string, any>;
}

export interface Summary {
  total_files: number;
  files_with_issues: number;
  total_issues: number;
  error_count: number;
  warning_count: number;
  info_count: number;
}

export interface Issue {
  file: string;
  line: number;
  column: number;
  severity: 'error' | 'warning' | 'info';
  message: string;
  rule: string;
  context?: string;
}

export interface CheckerType {
  id: string;
  name: string;
  description: string;
  icon: string;
}
```

## Key Features

### 1. Dashboard Overview (`/`)

**Components:**
- Summary statistics cards (total checks, issues found, pass rate)
- Recent check results timeline
- Quick action buttons (run new check - future feature)
- Chart showing issue trends over time (future)

**Data Display:**
- Total checks run
- Issues by severity (error/warning/info)
- Most recent check results
- Files with most issues

### 2. All Checks View (`/checks`)

**Components:**
- Filterable table of all check results
- Tabs for different checkers (Vale, Markdownlint, etc.)
- Search and filter controls
- Sort by date, checker, issue count

**Filters:**
- By checker type
- By date range
- By severity
- By file path

### 3. Individual Check Results (`/checks/[checker]`)

**Components:**
- Check summary card
- Issue breakdown by severity
- Grouped issue list (by file)
- Expandable issue details
- File tree navigation
- Export functionality (CSV, JSON)

**Features:**
- Click on file to see all issues in that file
- Click on issue to see context
- Filter issues by severity
- Search within issues

### 4. Issue Detail View

**Components:**
- Issue metadata (file, line, column, rule)
- Severity badge
- Full message
- Code context (if available)
- Link to rule documentation (future)

## API Routes

### GET `/api/results`

Fetch all check results from `.marvin/results/` directory.

**Query Parameters:**
- `checker` - Filter by checker type
- `limit` - Number of results to return
- `offset` - Pagination offset
- `sort` - Sort field (timestamp, issues, etc.)

**Response:**
```json
{
  "results": [
    {
      "id": "vale-2026-01-02-123456",
      "checker": "vale",
      "timestamp": "2026-01-02T12:34:56Z",
      "summary": { ... },
      "issues": [ ... ]
    }
  ],
  "total": 42,
  "page": 1,
  "pageSize": 20
}
```

### GET `/api/results/[id]`

Fetch a specific check result by ID.

**Response:**
```json
{
  "id": "vale-2026-01-02-123456",
  "checker": "vale",
  "timestamp": "2026-01-02T12:34:56Z",
  "path": "/path/to/docs",
  "summary": {
    "total_files": 50,
    "files_with_issues": 12,
    "total_issues": 34,
    "error_count": 5,
    "warning_count": 20,
    "info_count": 9
  },
  "issues": [
    {
      "file": "docs/getting-started.md",
      "line": 42,
      "column": 10,
      "severity": "warning",
      "message": "Use 'you' instead of 'one'",
      "rule": "Vale.Terms",
      "context": "When one wants to start..."
    }
  ],
  "metadata": {}
}
```

### POST `/api/checks` (Future Feature)

Trigger a new documentation check from the web interface.

**Request Body:**
```json
{
  "checker": "vale",
  "path": "/path/to/docs",
  "options": {}
}
```

## UI Component Specifications

### 1. Summary Stats Card

```tsx
<StatsCard
  title="Total Issues"
  value={summary.total_issues}
  trend="+12%"
  trendDirection="up"
  icon={<AlertCircle />}
  severity="warning"
/>
```

**Styling:**
- White background with subtle shadow
- Colored left border based on severity
- Large number display
- Small trend indicator
- Icon in top-right corner

### 2. Issue List Table

```tsx
<IssueTable
  issues={issues}
  onIssueClick={handleIssueClick}
  groupBy="file"
  sortBy="severity"
/>
```

**Features:**
- Sortable columns
- Expandable rows for issue details
- Severity badges with color coding
- File path with breadcrumb navigation
- Line/column numbers as links

### 3. Severity Badge

```tsx
<SeverityBadge severity="error" />
```

**Color Scheme:**
- Error: Red background, white text
- Warning: Amber background, dark text
- Info: Blue background, white text

### 4. Check History Timeline

```tsx
<CheckTimeline
  checks={recentChecks}
  maxItems={10}
/>
```

**Display:**
- Vertical timeline with dots
- Check name and timestamp
- Issue count summary
- Click to view details

## Styling Guidelines

### Tailwind Configuration

```typescript
// tailwind.config.ts
export default {
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#f5f5ff',
          100: '#ebebff',
          500: '#635BFF', // Stripe purple
          600: '#5851e8',
          700: '#4d47d1',
        },
        success: {
          500: '#00D924',
          600: '#00c020',
        },
        warning: {
          500: '#FFA500',
          600: '#e69500',
        },
        error: {
          500: '#DF1B41',
          600: '#c8183a',
        },
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
        mono: ['Fira Code', 'monospace'],
      },
      borderRadius: {
        'stripe': '6px',
      },
      boxShadow: {
        'stripe': '0 2px 4px rgba(0,0,0,0.06)',
        'stripe-lg': '0 4px 12px rgba(0,0,0,0.08)',
      },
    },
  },
}
```

### CSS Custom Properties

```css
/* styles/stripe-theme.css */
:root {
  --color-background: #ffffff;
  --color-foreground: #0a2540;
  --color-border: #e3e8ee;
  --color-muted: #697386;
  
  --spacing-section: 4rem;
  --spacing-card: 1.5rem;
  
  --radius-card: 6px;
  --radius-button: 6px;
  
  --shadow-card: 0 2px 4px rgba(0,0,0,0.06);
  --shadow-hover: 0 4px 12px rgba(0,0,0,0.08);
}
```

## Data Flow

### 1. File System Integration

The dashboard reads JSON files from the CLI output directory:

```
.marvin/results/
├── vale-2026-01-02-123456.json
├── vale-2026-01-02-234567.json
└── markdownlint-2026-01-02-345678.json
```

### 2. API Layer

API routes use Node.js `fs` module to:
- List all result files
- Read specific result files
- Parse JSON content
- Return formatted responses

### 3. Client-Side Caching

Use SWR or TanStack Query for:
- Automatic refetching
- Cache invalidation
- Optimistic updates
- Loading states

### 4. Real-time Updates (Future)

Implement file watching to auto-refresh when new results are generated:
- Use `chokidar` to watch `.marvin/results/`
- WebSocket or Server-Sent Events for live updates
- Toast notifications for new check results

## Implementation Phases

### Phase 1: Foundation (MVP)
- [ ] Set up Next.js project with TypeScript and Tailwind
- [ ] Create basic layout (header, sidebar, main content)
- [ ] Implement API routes to read result files
- [ ] Create TypeScript types matching CLI models
- [ ] Build dashboard overview page with summary stats

### Phase 2: Core Features
- [ ] Implement all checks view with filtering
- [ ] Create individual check result pages
- [ ] Build issue list and detail components
- [ ] Add severity badges and status indicators
- [ ] Implement search and filter functionality

### Phase 3: Enhanced UX
- [ ] Add file tree navigation
- [ ] Implement sorting and pagination
- [ ] Create export functionality (CSV, JSON)
- [ ] Add responsive design for mobile
- [ ] Implement dark mode toggle

### Phase 4: Advanced Features (Future)
- [ ] Trigger checks from web interface
- [ ] Real-time updates via WebSocket
- [ ] Issue trend charts and analytics
- [ ] Rule documentation integration
- [ ] User preferences and settings
- [ ] Multi-project support

## Development Workflow

### Setup

```bash
cd web
bun install
bun run dev
```

### Environment Variables

```env
# .env.local
NEXT_PUBLIC_RESULTS_DIR=../.marvin/results
NEXT_PUBLIC_APP_NAME=Marvin Dashboard
```

### Scripts

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "format": "prettier --write .",
    "type-check": "tsc --noEmit"
  }
}
```

## File Reading Strategy

### API Route Implementation

```typescript
// app/api/results/route.ts
import { readdir, readFile } from 'fs/promises';
import { join } from 'path';
import { NextResponse } from 'next/server';

const RESULTS_DIR = join(process.cwd(), '..', '.marvin', 'results');

export async function GET(request: Request) {
  try {
    const files = await readdir(RESULTS_DIR);
    const jsonFiles = files.filter(f => f.endsWith('.json'));
    
    const results = await Promise.all(
      jsonFiles.map(async (file) => {
        const content = await readFile(join(RESULTS_DIR, file), 'utf-8');
        const data = JSON.parse(content);
        return {
          id: file.replace('.json', ''),
          ...data
        };
      })
    );
    
    // Sort by timestamp, newest first
    results.sort((a, b) =>
      new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()
    );
    
    return NextResponse.json({ results });
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to read results' },
      { status: 500 }
    );
  }
}
```

## Accessibility

- Semantic HTML elements
- ARIA labels for interactive elements
- Keyboard navigation support
- Focus indicators
- Screen reader friendly
- Color contrast compliance (WCAG AA)

## Performance Considerations

- Server-side rendering for initial page load
- Client-side caching with SWR/TanStack Query
- Lazy loading for large issue lists
- Virtual scrolling for tables with many rows
- Image optimization with Next.js Image component
- Code splitting by route

## Testing Strategy

- **Unit Tests**: Jest + React Testing Library
- **E2E Tests**: Playwright (future)
- **Type Safety**: TypeScript strict mode
- **Linting**: ESLint with Next.js config

## Browser Support

- Chrome/Edge (latest 2 versions)
- Firefox (latest 2 versions)
- Safari (latest 2 versions)

## Future Enhancements

1. **Analytics Dashboard**
   - Issue trends over time
   - Most common rule violations
   - File quality scores
   - Team performance metrics

2. **Collaboration Features**
   - Comments on issues
   - Issue assignment
   - Status tracking (open/resolved)
   - Integration with GitHub Issues

3. **Configuration Management**
   - Edit Vale/Markdownlint configs from UI
   - Rule enable/disable toggles
   - Custom rule creation

4. **Notifications**
   - Email alerts for new issues
   - Slack/Discord integration
   - Webhook support

5. **Multi-Project Support**
   - Switch between different documentation projects
   - Aggregate statistics across projects
   - Project-specific configurations

## Dependencies

```json
{
  "dependencies": {
    "next": "^14.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.3.0",
    "tailwindcss": "^3.4.0",
    "@radix-ui/react-tabs": "^1.0.4",
    "@radix-ui/react-select": "^2.0.0",
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-tooltip": "^1.0.7",
    "lucide-react": "^0.300.0",
    "swr": "^2.2.4",
    "clsx": "^2.0.0",
    "tailwind-merge": "^2.2.0",
    "date-fns": "^3.0.0"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "eslint": "^8.56.0",
    "eslint-config-next": "^14.0.0",
    "prettier": "^3.1.0",
    "prettier-plugin-tailwindcss": "^0.5.0"
  }
}
```

## Design System Reference

The dashboard follows these Stripe-inspired design principles:

1. **Typography**
   - Headings: Inter, bold, generous line-height
   - Body: Inter, regular, 16px base size
   - Code: Fira Code, monospace

2. **Spacing**
   - Base unit: 4px (0.25rem)
   - Section spacing: 64px (4rem)
   - Card padding: 24px (1.5rem)

3. **Colors**
   - Use semantic color names (primary, success, warning, error)
   - Maintain consistent opacity levels
   - Ensure sufficient contrast ratios

4. **Interactions**
   - Smooth transitions (150-200ms)
   - Hover states for all interactive elements
   - Loading states with skeleton screens
   - Error states with helpful messages

## Getting Started

Once the implementation begins, developers should:

1. Review this plan thoroughly
2. Set up the Next.js project structure
3. Install dependencies
4. Configure Tailwind with the Stripe-inspired theme
5. Create base UI components
6. Implement API routes for file reading
7. Build dashboard pages incrementally
8. Test with actual CLI output files

## Questions to Consider

Before implementation, clarify:

1. Should the dashboard be read-only or allow triggering checks?
2. Do we need authentication/authorization?
3. Should we support multiple result directories?
4. What's the expected scale (number of files, issues)?
5. Do we need historical data retention policies?
